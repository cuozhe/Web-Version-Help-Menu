# 蓑衣帮助（Help）后台管理系统

## 项目简介

基于 PHP + MySQL 的单页帮助/导航网站，前台美观简洁，后台可视化管理内容。支持站点标题与样式设置、板块与菜单项的完整 CRUD、可见性控制、排序与跨板块移动、图片上传等。

- 前台自适应，支持 LOGO、背景、卡片透明度
- 后台支持板块/菜单项增删改查、隐藏/显示、排序、跨板块移动
- 安全的图片上传校验（类型/大小），更稳健的提示信息与跳转
- MySQL 数据库，结构简单，易于二次开发

## 最近更新（后端修复与功能完善）

- 修复消息提示的 XSS 风险，统一对消息进行转义/编码
- 站点设置自动兜底：若 settings 表为空，会自动写入一条默认记录（id=1）
- 新增更严格的图片上传校验：仅允许常见图片类型（png/jpg/gif/webp/ico），限制大小（≤5MB），确保来自合法上传
- 新增板块排序：支持“上移/下移”，基于 `sort_order` 字段
- 新增菜单项排序：在所属板块内可“上移/下移”，基于 `sort_order` 字段
- 新增后台快速搜索：在“板块管理”中根据标题/描述/链接进行前端过滤
- 规范化链接：新增/编辑菜单项时，若输入的链接未带协议，将自动补全为 `http://`
- 多处体验优化：锚点跳转、消息提示中文本编码、上传目录自动创建等

## 功能特性

- 后台登录（默认账号/密码：`admin`/`admin123`）
- 板块管理：新增、编辑、删除、隐藏/显示、排序（上移/下移）
- 菜单项管理：新增、编辑、删除、隐藏/显示、排序（上移/下移）、跨板块移动、图标上传
- 站点设置：网站标题、LOGO、背景图片、卡片透明度
- 前台自适应美观展示，支持移动端

## 目录结构

```
help/
├── admin/              # 后台管理目录
│   ├── index.php       # 后台主页面（管理站点设置/板块/菜单项）
│   ├── login.php       # 登录页
│   ├── logout.php      # 退出登录
│   └── db.php          # 数据库连接（PDO）
├── api/                # 扩展 API
│   ├── homepage-image.php            # 实时返回首页图片（优先背景图，其次 LOGO）
│   └── realtime-homepage-image.php  # 兼容入口
├── uploads/            # 上传的图片（LOGO、背景、图标）
├── index.php           # 前台页面
├── styles.css          # 公共样式
└── install.sql         # 数据库初始化脚本
```

## 安装与部署

1. 导入数据库
   - 使用 phpMyAdmin 或命令行执行 `install.sql`，初始化数据表和默认数据。

2. 配置数据库连接
   - 修改 `help/admin/db.php`，填写你的 MySQL 主机、数据库名、账号与密码。

3. 设置 uploads 目录权限
   - 确保 `help/uploads/` 目录具有 Web 服务器的写权限，用于图片上传。

4. 部署到服务器
   - 环境要求：PHP 7.2+、MySQL 5.7+，启用 PDO 扩展；建议启用 `fileinfo` 扩展以进行图片 MIME 类型校验。
   - 访问路径：前台 `/help/index.php`，后台 `/help/admin/index.php`。

## 数据库结构（概览）

- `admin`：后台账号表（默认账号 `admin`/`admin123`）
- `sections`：板块表（标题、排序、是否隐藏）
- `items`：菜单项表（所属板块、标题、描述、图标、链接、排序、是否隐藏）
- `settings`：站点设置（标题、LOGO、背景、卡片透明度）

详见 `install.sql`。运行时系统会自动进行少量结构/数据兜底，例如为 `settings` 插入默认记录、缺字段时自动添加（card_opacity/hidden 等）。

## 使用说明

- 后台登录 `/help/admin/index.php` 后即可：
  - 在“站点设置”中设置标题、LOGO、背景、卡片透明度
  - 在“板块管理”中：新增/修改/删除/隐藏板块，支持上移/下移
  - 在每个板块下：新增/修改/删除/隐藏菜单项，支持上移/下移，或移动到其他板块
  - 顶部搜索框可快速过滤当前页面中的菜单项
- 前台会自动展示未隐藏的板块与菜单项。

## API

- 实时首页图片：`/help/api/homepage-image.php`
  - 优先返回背景图，其次 LOGO；若均未设置，返回动态生成的 PNG（提供简要标题）。
  - 已设置 no-cache 响应头，确保实时性。
- 兼容入口：`/help/api/realtime-homepage-image.php`

## 安全说明与建议

- 登录密码当前使用 MD5 示例，生产环境建议改为 `password_hash/password_verify`。
- 图片上传仅允许常见图片类型且限制大小（≤5MB），依赖 PHP `fileinfo` 扩展以检测 MIME 类型。
- 后台所有操作均通过服务器端校验与预处理语句执行，减少 SQL 注入风险。

## 常见问题

- 图片未显示？
  - 检查 `help/uploads/` 目录是否可写，路径应形如 `/help/uploads/xxx.png`。
- 数据库报错？
  - 确保执行了 `install.sql`，并在 `help/admin/db.php` 配置了正确的连接信息。
- 后台空白？
  - 检查 PHP 错误日志与数据库连接；确认开启了 PDO 扩展，且 `help/admin/db.php` 配置正确。

## 预览

> 可自行将前后截图保存到 `docs/` 目录，并在此处引用。

## 许可

- 本项目基于 MIT License 发布，详见 `LICENSE`。

---

如有建议或问题，欢迎提交 Issue 或 PR！
